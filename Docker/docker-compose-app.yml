services:
  webapi:
    build:
      context: ..
      dockerfile: WebApi/Docker/Dockerfile
    container_name: webapi
    restart: unless-stopped
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8080
      ConnectionStrings__DefaultConnection: "Server=sqlserver,1433;Database=Project;User ID=sa;Password=${SA_PASSWORD};TrustServerCertificate=True;"
    # QUITAMOS LOS PUERTOS EXTERNOS DE AQUI para que solo se entre por NGINX
    # ports:
    #   - "8080:8080" 
    networks:
      - raptor-network

  # --- NUEVO: NGINX ---
  reverse-proxy:
    image: nginx:latest
    container_name: reverse-proxy
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80" # Entramos por el puerto 80 est√°ndar
    depends_on:
      - webapi
    networks:
      - raptor-network

networks:
  raptor-network:
    external: true